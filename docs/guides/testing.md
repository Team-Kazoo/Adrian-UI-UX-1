# React Migration Testing Guide (v2 - Clean Architecture)

## ğŸ¯ æ¶æ„å˜æ›´

### ä¹‹å‰ (æœ‰é—®é¢˜çš„æ–¹å¼):
```
React Hook â†’ window.app â†’ Legacy JS (ç´§è€¦åˆï¼Œè„†å¼±)
```

### ç°åœ¨ (æ¸…æ™°çš„æ–¹å¼):
```
React Hook â†’ AudioService â†’ Legacy JS (æ¾è€¦åˆï¼Œå¯æµ‹è¯•)
```

**ä¼˜åŠ¿**:
- âœ… å•å…ƒæµ‹è¯•è¦†ç›– (15ä¸ªæ–°æµ‹è¯•)
- âœ… TypeScript ç±»å‹å®‰å…¨
- âœ… æ¸…æ™°çš„è´£ä»»è¾¹ç•Œ
- âœ… æ˜“äºè°ƒè¯•å’Œç»´æŠ¤

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### 1. è¿è¡Œå•å…ƒæµ‹è¯•

```bash
npm test
```

**é¢„æœŸè¾“å‡º**:
```
âœ“ AudioService - Unit Tests (15 tests)
âœ“ PitchDetector (48 tests)
âœ“ AudioIO (106 tests)

Total: 169 tests passing âœ…
```

### 2. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm start
```

æµè§ˆå™¨è®¿é—®: **http://localhost:5173/**

### 3. æ£€æŸ¥åˆå§‹åŒ–

æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼Œåº”è¯¥çœ‹åˆ°:

```javascript
[AudioService] âœ“ Initialization complete
```

**é¡µé¢çŠ¶æ€**:
- âœ… ä¹å™¨é€‰æ‹©é¢æ¿å¯ç‚¹å‡»ï¼ˆä¸æ˜¯ç°è‰²ï¼‰
- âœ… çŠ¶æ€æ˜¾ç¤º: "Ready - Click Start to begin"
- âœ… "Start Playing" æŒ‰é’®å¯ç”¨

**å¦‚æœä¹å™¨æŒ‰é’®ç°è‰²**:
- ç­‰å¾… 3-5 ç§’è®©ç³»ç»Ÿåˆå§‹åŒ–
- æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
- åˆ·æ–°é¡µé¢é‡è¯•

### 4. æµ‹è¯•éŸ³é¢‘æ’­æ”¾

#### Test 1: åŸºæœ¬æ’­æ”¾
1. ç‚¹å‡» **"Start Playing"** æŒ‰é’®
2. æµè§ˆå™¨è¯·æ±‚éº¦å…‹é£æƒé™ â†’ **ç‚¹å‡»"å…è®¸"**
3. å¯¹ç€éº¦å…‹é£å”± "å•Š~~~~" (æŒç»­ 2-3 ç§’)

**é¢„æœŸç»“æœ**:
- âœ… å¬åˆ° saxophone å£°éŸ³
- âœ… çŠ¶æ€æ˜¾ç¤º "Playing (saxophone)"
- âœ… æ˜¾ç¤ºå½“å‰éŸ³é«˜ï¼ˆå¦‚ "C4", "261.6 Hz"ï¼‰
- âœ… å®æ—¶å¯è§†åŒ–åŒºåŸŸå‡ºç°

#### Test 2: ä¹å™¨åˆ‡æ¢
1. åœ¨æ’­æ”¾çŠ¶æ€ä¸‹ï¼Œç‚¹å‡» **"Violin"** æŒ‰é’®
2. å†æ¬¡å”±ä¸€ä¸ªéŸ³

**é¢„æœŸç»“æœ**:
- âœ… å£°éŸ³ç«‹å³ä» saxophone å˜ä¸º violin
- âœ… çŠ¶æ€æ›´æ–°ä¸º "Playing (violin)"
- âœ… æ— éœ€é‡å¯éŸ³é¢‘

#### Test 3: åœæ­¢/é‡å¯
1. ç‚¹å‡» **"Stop"** æŒ‰é’®
2. ç­‰å¾… 1 ç§’
3. å†æ¬¡ç‚¹å‡» **"Start Playing"**

**é¢„æœŸç»“æœ**:
- âœ… éŸ³é¢‘å¹²å‡€åœæ­¢ï¼ˆæ— æ‚éŸ³ï¼‰
- âœ… çŠ¶æ€å›åˆ° "Ready"
- âœ… é‡å¯åä»ç„¶å¯ç”¨

### 5. è°ƒè¯•å‘½ä»¤

åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œ:

```javascript
// æ£€æŸ¥ AudioService çŠ¶æ€
window.app

// æ£€æŸ¥å®¹å™¨
window.container.getServiceNames()

// æ£€æŸ¥å»¶è¿Ÿ
window.app?.getLatencyStats?.()

// æ£€æŸ¥éŸ³é¢‘æ¨¡å¼
window.container.get('audioIO')?.mode
```

---

## âœ… æµ‹è¯•é€šè¿‡æ ‡å‡†

| åŠŸèƒ½ | çŠ¶æ€ |
|------|------|
| å•å…ƒæµ‹è¯• | âœ… 169/169 passing |
| é¡µé¢åŠ è½½ | âœ… æ— é”™è¯¯ |
| éŸ³é¢‘åˆå§‹åŒ– | âœ… 3ç§’å†…å®Œæˆ |
| éº¦å…‹é£è®¿é—® | âœ… æƒé™æ­£å¸¸ |
| éŸ³é¢‘æ’­æ”¾ | âœ… èƒ½å¬åˆ°å£°éŸ³ |
| éŸ³é«˜æ£€æµ‹ | âœ… å®æ—¶æ˜¾ç¤º |
| ä¹å™¨åˆ‡æ¢ | âœ… ç«‹å³ç”Ÿæ•ˆ |
| åœæ­¢/é‡å¯ | âœ… æ­£å¸¸å·¥ä½œ |

---

## âŒ å¸¸è§é—®é¢˜

### é—®é¢˜ 1: "PitchDetector is not defined"

**åŸå› **: æ—§çš„ä¾èµ–åŠ è½½é—®é¢˜ï¼ˆå·²ä¿®å¤ï¼‰

**è§£å†³**:
- åˆ·æ–°é¡µé¢
- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜: `Cmd+Shift+R` (Mac) æˆ– `Ctrl+Shift+R` (Windows)

### é—®é¢˜ 2: ä¹å™¨æŒ‰é’®ä¸€ç›´æ˜¯ç°è‰²

**ç—‡çŠ¶**: `disabled` å±æ€§æŒç»­å­˜åœ¨

**è°ƒè¯•**:
```javascript
// æ£€æŸ¥ AudioService çŠ¶æ€
window.app
// åº”è¯¥å­˜åœ¨ä¸”æœ‰ initialize æ–¹æ³•

// æ£€æŸ¥åˆå§‹åŒ–æ˜¯å¦å®Œæˆ
// å¦‚æœè¶…è¿‡ 10 ç§’è¿˜æ˜¯ç°è‰²ï¼Œåˆ·æ–°é¡µé¢
```

### é—®é¢˜ 3: AudioContext suspended è­¦å‘Š

**ç—‡çŠ¶**: æ§åˆ¶å°æ˜¾ç¤º "AudioContext was not allowed to start"

**åŸå› **: æµè§ˆå™¨å®‰å…¨é™åˆ¶

**è§£å†³**: è¿™æ˜¯æ­£å¸¸çš„ï¼åªè¦ç‚¹å‡» "Start Playing" åèƒ½å¬åˆ°å£°éŸ³å³å¯

### é—®é¢˜ 4: å¬ä¸åˆ°å£°éŸ³

**æ£€æŸ¥æ¸…å•**:
1. âœ… éº¦å…‹é£æƒé™å·²æˆäºˆï¼Ÿ
2. âœ… ç”µè„‘éŸ³é‡ > 0ï¼Ÿ
3. âœ… éº¦å…‹é£æœ‰è¾“å…¥ä¿¡å·ï¼Ÿï¼ˆçœ‹éŸ³é«˜æ˜¯å¦æ›´æ–°ï¼‰
4. âœ… æ§åˆ¶å°æœ‰ "AudioContext resumed" æ¶ˆæ¯ï¼Ÿ

---

## ğŸ”§ é«˜çº§è°ƒè¯•

### æŸ¥çœ‹å®Œæ•´åˆå§‹åŒ–æ—¥å¿—

```javascript
// è®¾ç½®è¯¦ç»†æ—¥å¿—
localStorage.setItem('debug', 'audio:*')

// åˆ·æ–°é¡µé¢
location.reload()
```

### æµ‹è¯• AudioService ç›´æ¥è°ƒç”¨

```javascript
// è·å–æœåŠ¡å®ä¾‹
const service = window.app

// æ‰‹åŠ¨å¯åŠ¨
await service.start()

// åˆ‡æ¢ä¹å™¨
service.changeInstrument('piano')

// åœæ­¢
service.stop()
```

### æ€§èƒ½åˆ†æ

```javascript
// æ£€æŸ¥å»¶è¿Ÿ
window.app.getLatencyStats()
// ç›®æ ‡: < 90ms (v0.3.0), < 50ms (v1.0)

// æ£€æŸ¥éŸ³é¢‘æ¨¡å¼
window.container.get('audioIO').mode
// æœ€ä½³: 'worklet'
// å›é€€: 'script-processor'
```

---

## ğŸ“Š æ€§èƒ½åŸºå‡†

| æŒ‡æ ‡ | v0.3.0 ç›®æ ‡ | v1.0 ç›®æ ‡ | å½“å‰ |
|------|-------------|-----------|------|
| åˆå§‹åŒ–æ—¶é—´ | < 5s | < 3s | ~3s âœ… |
| ç«¯åˆ°ç«¯å»¶è¿Ÿ | < 90ms | < 50ms | ~180ms âš ï¸ |
| æµ‹è¯•è¦†ç›–ç‡ | 15% | 40% | 10% |
| å†…å­˜å ç”¨ | < 100MB | < 80MB | TBD |

---

## ğŸ“ æ¶æ„ç†è§£

### AudioService èŒè´£

```typescript
class AudioService {
  // çŠ¶æ€ç®¡ç†
  getState(): AudioState
  subscribe(listener): unsubscribe

  // ç”Ÿå‘½å‘¨æœŸ
  initialize(): Promise<void>
  destroy(): void

  // éŸ³é¢‘æ§åˆ¶
  start(): Promise<void>
  stop(): void

  // é…ç½®
  changeInstrument(instrument)
  changeMode(mode)

  // æ•°æ®æ›´æ–°
  updatePitchData(data)
  updateLatency(latency)
}
```

### useAudioService Hook èŒè´£

```typescript
function useAudioService() {
  // 1. åˆ›å»º AudioService å®ä¾‹
  // 2. è®¢é˜…çŠ¶æ€å˜åŒ– â†’ æ›´æ–° React state
  // 3. æä¾› start/stop/changeInstrument æ–¹æ³•
  // 4. è½®è¯¢ DOM è·å–å®æ—¶æ•°æ®ï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰
  // 5. æ¸…ç†èµ„æº
}
```

---

## ğŸš€ ä¸‹ä¸€æ­¥ä¼˜åŒ–

### Phase 3: å®Œå…¨ TypeScript åŒ–ï¼ˆå¯é€‰ï¼‰

1. è¿ç§» `PitchDetector` åˆ° TypeScript
2. è¿ç§» `AudioIO` åˆ° TypeScript
3. è¿ç§» `Synthesizer` åˆ° TypeScript
4. ç§»é™¤ DOM è½®è¯¢ï¼Œä½¿ç”¨äº‹ä»¶ç³»ç»Ÿ

### Phase 4: æ€§èƒ½ä¼˜åŒ–

1. å‡å°‘å»¶è¿Ÿ (180ms â†’ 90ms)
2. ä¼˜åŒ– FFT è®¡ç®—
3. AudioWorklet ä¼˜åŒ–
4. å‡å°‘ console.log

---

## ğŸ“ æäº¤æ¸…å•

åœ¨æäº¤ PR å‰ç¡®è®¤:

- [ ] `npm test` å…¨éƒ¨é€šè¿‡
- [ ] `npm run build` æ— é”™è¯¯
- [ ] æµè§ˆå™¨æµ‹è¯•é€šè¿‡ï¼ˆ3ä¸ªä¹å™¨ + åœæ­¢/é‡å¯ï¼‰
- [ ] æ§åˆ¶å°æ— ä¸¥é‡é”™è¯¯
- [ ] å»¶è¿Ÿæœªæ˜¾è‘—å¢åŠ 
- [ ] README.md å·²æ›´æ–°ï¼ˆå¦‚éœ€è¦ï¼‰

---

**æµ‹è¯•äºº**: __________
**æµ‹è¯•æ—¥æœŸ**: __________
**æµè§ˆå™¨**: Chrome / Firefox / Safari (é€‰æ‹©ä¸€ä¸ª)
**æµ‹è¯•ç»“æœ**: âœ… é€šè¿‡ / âŒ å¤±è´¥
**å¤‡æ³¨**: ______________________________
